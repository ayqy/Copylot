# 未来功能与当前差距规划 (Future Features & Gaps)

本文档旨在记录在 `v1.1.3` 版本的用户手册和代码实现之间存在的所有差距。这既包括了手册中描述超出实际能力的功能，也包括了代码已实现但手册未提及的隐藏功能。本文档可作为未来版本开发和文档优化的统一参考。

---

## 1. 功能已承诺/描述，但代码尚未完全实现

### 1.1. 真正的智能页面内容清洗 (True Smart Page Cleaning)

-   **当前状态 (v1.1.3):**
    -   插件能够基于用户的点击，智能地识别并选中一个逻辑上的内容块（如一个段落、一篇文章的主体 `div`）。
    -   插件通过 `createVisibleClone` 预处理器，可以有效去除选区内的不可见元素（例如通过 `display: none` 隐藏的DOM节点）。
    -   插件在将HTML转换为Markdown时，会去除 `<script>` 和 `<style>` 等标签。

-   **与文档描述的差距:**
    -   当前的用户手册中描述为：“...去除广告、导航栏、推荐阅读等多余内容。”
    -   这是一个对未来能力的期望描绘，当前版本**不具备**通过语义分析来主动识别并移除页面上特定功能区域（如广告侧边栏 `sidebar`、顶部导航 `nav`、页脚 `footer`）的能力。它识别的范围仍然局限于用户点击的那个“块”，如果用户点击的“块”本身就包含了推荐阅读等内容，它们依然会被复制下来。

-   **未来实现方向:**
    -   可以引入更高级的DOM分析算法，借鉴阅读模式（Reader Mode）的实现思路。
    -   通过分析DOM节点的标签（如 `article`, `main`）、className/id（如 `"post-body"`, `"main-content"`）以及节点自身的结构和文本密度，来计算出页面的“核心内容区域”。
    -   在“转换整个页面”的功能中，只针对这个计算出的核心内容区域进行处理，从而实现真正意义上的“去噪”。
    -   可以维护一个常见广告、评论区、导航栏的 className/id 黑名单，在预处理阶段直接从DOM克隆中移除这些节点。

### 1.2. 弹出菜单中的语言切换功能

-   **当前状态 (v1.1.3):**
    -   代码（`popup.ts`）中没有提供语言切换的UI控件，相关逻辑也被注释或移除。
    -   插件语言目前依赖于 `chrome.i18n.getUILanguage()`，即跟随浏览器或操作系统的语言设置自动切换。

-   **与文档描述的差距:**
    -   用户手册的“设置”章节和相关截图说明中，明确指出了用户可以在插件的弹出菜单中手动“切换插件界面语言”。
    -   这是一个**已承诺但未实现**的功能。

-   **未来实现方向:**
    -   在 `popup.html` 中重新加入一个语言选择的下拉菜单（`<select>`）。
    -   在 `popup.ts` 中添加事件监听器，当用户选择新语言时，调用 `saveSettings` 将语言偏好（如 `'en'`, `'zh'`）保存到 `chrome.storage.local`。
    -   修改 `settings-manager.ts`，使其在 `getSettings` 时优先读取用户保存的语言设置，覆盖 `getSystemLanguage` 的结果。

## 2. 代码已实现，但文档/UI未能充分利用

### 2.1. Prompt 管理器中的大量隐藏功能

-   **当前状态 (v1.1.3):**
    -   `options.ts` 实现了一个非常强大的 Prompt 管理器。
    -   用户手册中仅描述了“新建、管理（编辑/删除）、导入/导出”等基本操作。

-   **与文档描述的差距（用户价值损失）:**
    -   **预设模板 (Preset Prompts):** 代码中内置了用于总结、翻译、编程等场景的预设模板，但手册和UI中均未引导用户使用。
    -   **分类管理 (Category Management):** 支持为 Prompt 设置分类并在主页筛选，但手册未提及。
    -   **克隆功能 (Duplicate/Clone):** 支持一键复制一个现有 Prompt，但手册未提及。
    -   **批量操作 (Batch Actions):** 支持全选和批量删除，但手册未提及。
    -   **实时预览 (Live Preview):** 在编辑器中可以实时预览 Prompt 应用于示例文本后的效果，但手册未提及。

-   **未来实现方向:**
    -   **文档侧：** 大幅更新用户手册中“管理您的Prompt”一节，详细介绍上述所有高级功能，并配上相应的截图说明。
    -   **UI/UX 侧：** 在首次打开选项页时，可以更主动地向用户展示预设模板，并引导其添加。

### 2.2. Prompt 使用数据未被充分利用

-   **当前状态 (v1.1.3):**
    -   代码已在 `Prompt` 类型中定义了 `usageCount` 和 `lastUsedAt` 字段，并在用户每次使用 Prompt 时（通过右键菜单）更新这些数据。
    -   Prompt 管理器页面也已在卡片上显示了这些数据。

-   **与用户体验的差距:**
    -   虽然收集并展示了数据，但**未能将其转化为提升效率的功能**。用户无法按“最常用”或“最近使用”对 Prompt 列表进行排序。

-   **未来实现方向:**
    -   在 Prompt 管理页面的筛选器旁边，增加一个“排序方式”的下拉菜单。
    -   提供选项：按标题排序（默认）、按使用次数排序、按最后使用时间排序。
    -   在 `filterAndRenderPrompts` 函数中增加相应的排序逻辑。

## 3. UI/UX 体验不一致与待优化点

### 3.1. Prompt 应用范围不一致

-   **当前状态 (v1.1.3):**
    -   通过**右键菜单**使用 Prompt 时，如果用户没有用鼠标划词，Prompt会应用于整个页面内容。
    -   通过**悬浮按钮**的菜单使用 Prompt 时，Prompt 只会应用于按钮所在的那个内容块。

-   **与用户体验的差距:**
    -   同一功能（使用Prompt）在不同入口下的行为不一致，可能会导致用户困惑。

-   **未来实现方向:**
    -   **方案A (统一行为):** 让悬浮按钮也具有感知“页面文本选择”的能力。如果用户划词了，悬浮按钮的Prompt就作用于划词内容；如果没划词，才作用于自身所在的内容块。
    -   **方案B (明确标识):** 在UI上明确区分。例如，右键菜单的Prompt项可以叫做“用‘总结’处理页面”，而悬浮按钮的可以叫做“用‘总结’处理此块”。

### 3.2. 富媒体内容复制的期望差距

-   **当前状态 (v1.1.3):**
    -   能识别图片、视频、SVG、Canvas等富媒体元素为“可复制块”。
    -   实际复制产出为：图片的Markdown语法、视频的链接、SVG的代码、Canvas的描述文本。

-   **与用户体验的差距:**
    -   用户在复制一个 `<canvas>` 元素时，直觉上可能期望得到画布上呈现的**图像**，而非一段如 `[Canvas Element]` 的文本。
    -   这种“所见非所得”会降低特定场景下的可用性。

-   **未来实现方向:**
    -   **Canvas 增强:** 在处理 `<canvas>` 元素时，尝试调用 `canvas.toDataURL('image/png')` 方法，将其内容转换为 Base64 编码的图片数据。然后可以像处理普通图片一样，将其转换为 Markdown 语法或直接写入剪贴板（如果浏览器支持）。
    -   **视频缩略图:** 考虑在复制视频时，如果视频无 `poster`，可以动态创建一个 `<video>` 元素，加载视频并播放一帧，然后将其绘制到 `<canvas>` 上，再通过上述方法提取该帧作为缩略图。此方案较为复杂，需考虑性能影响。 