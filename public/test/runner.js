function Q(e){const t=e.cloneNode(!1);return U(e,t),t}function U(e,t){const n=Array.from(e.childNodes);for(const o of n){if(o.nodeType===Node.TEXT_NODE){if((o.textContent??"").trim()==="")continue;t.appendChild(o.cloneNode());continue}if(o.nodeType===Node.ELEMENT_NODE){const r=o;if(W(r))continue;const s=r.cloneNode(!1);t.appendChild(s),U(r,s)}}}function W(e){const t=a=>(console.log(`[Debug DOM Preprocessor] Hiding ${e.tagName}#${e.id}.${e.className} due to: ${a}`,e),!0);if(e.getAttribute("aria-hidden")==="true")return t("aria-hidden=true");const n=e.getAttribute("role");if(n==="presentation"||n==="none")return t(`role=${n}`);const o=e.className;if(o&&typeof o=="string"&&/(sr-only|visually-hidden|screen-reader-only)/i.test(o))return t("screen reader class");const r=window.getComputedStyle(e);if(r.display==="none"||r.visibility==="hidden")return t(`display: ${r.display} or visibility: ${r.visibility}`);const s=parseFloat(r.opacity||"1");if(!isNaN(s)&&s<=.05)return t(`opacity: ${s}`);if(/scale\(0/.test(r.transform)||/scaleX\(0/.test(r.transform)||/scaleY\(0/.test(r.transform))return t(`transform: ${r.transform}`);if(/opacity\(0/.test(r.filter))return t(`filter: ${r.filter}`);if(r.clip==="rect(0px, 0px, 0px, 0px)"||/inset\(100%/.test(r.clipPath))return t(`clip/clip-path: ${r.clip||r.clipPath}`);const i=parseFloat(r.textIndent||"0");if(!isNaN(i)&&i<=-9999)return t(`text-indent: ${i}`);if(e.offsetWidth+e.offsetHeight+e.clientWidth+e.clientHeight===0){if(e.children.length>0){for(let a=0;a<e.children.length;a++)if(!W(e.children[a]))return!1}return t("Zero size with no visible children")}try{const a=e.getBoundingClientRect();if(a.width>0&&a.height>0&&(a.bottom<0||a.right<0))return t("Element is out of viewport")}catch{}return!1}let T=null,$=null;function V(e){let t;if(e.tagName.toLowerCase()==="pre"){const o=e.cloneNode(!0),r=o.querySelector("code");r&&(o.innerHTML="",o.appendChild(r)),t=o.innerText||o.textContent||""}else t=e.innerText||e.textContent||"";const n=q(t);if(e.tagName.toLowerCase()==="pre"){const r=(e.className||"").match(/language-(\w+)/);return"\n\n```"+(r?r[1]:"")+`
`+n+"\n```\n\n"}else return"`"+n+"`"}function q(e){let t=e.replace(/(Copy|复制代码|Copy to clipboard|复制)\s*$/,"");return t=t.replace(/\\#/g,"#").replace(/\\=/g,"=").replace(/\\\*/g,"*").replace(/\\\[/g,"[").replace(/\\\]/g,"]").replace(/\\\(/g,"(").replace(/\\\)/g,")"),t}function X(e){return e instanceof HTMLTableElement?[e]:Array.from(e.querySelectorAll("table"))}function K(e,t,n){console.debug("AI Copilot: processElementWithMixedContent (text-replacement strategy) - Start",{elementTag:e.tagName,tablesCount:t.length,tableOutputFormat:n.tableOutputFormat,outputFormat:n.outputFormat});let o=D(e);return t.forEach((r,s)=>{const i=G(r.outerHTML);let c;n.tableOutputFormat==="csv"?c=Z(r):c=i,console.debug(`AI Copilot: Table ${s} replacement`,{target:i,replacement:c}),i.trim()&&(o=o.replace(i,c))}),console.debug("AI Copilot: processElementWithMixedContent - End, returning:",o),o}function ee(){if(!T){if(typeof TurndownService>"u")return console.error("TurndownService is not available. Markdown conversion will fail."),{turndown:e=>e};T=new TurndownService({headingStyle:"atx",hr:"---",bulletListMarker:"-",codeBlockStyle:"fenced",fence:"```",emDelimiter:"*",strongDelimiter:"**",linkStyle:"inlined",linkReferenceStyle:"full"}),T.addRule("preserveLineBreaks",{filter:["br"],replacement:()=>`
`}),T.addRule("simplifyNestedTags",{filter:["font","span"],replacement:e=>e}),T.remove(["script","style","noscript","#ai-copilot-copy-btn"]),T.addRule("codeBlock",{filter:["pre","code"],replacement:function(e,t,n){return V(t)}})}return T}function j(){if(!$){if(typeof TurndownService>"u")return console.error("TurndownService is not available. Markdown conversion will fail."),{turndown:t=>t};const e=window.turndownPluginGfm;if(!e)return console.error("turndown-plugin-gfm is not available. Using basic turndown."),ee();$=new TurndownService({headingStyle:"atx",bulletListMarker:"-",codeBlockStyle:"fenced",fence:"```",emDelimiter:"*",strongDelimiter:"**",linkStyle:"inlined"}),$.use(e.gfm),$.addRule("codeBlock",{filter:["pre","code"],replacement:function(t,n,o){return V(n)}})}return $}function G(e){try{return j().turndown(e)}catch(t){return console.error("HTML转Markdown转换失败:",t),e}}function te(e){if(!e||e.trim()==="")return!1;const t=[/^javascript:/i,/^#.*$/,/^#$/,/^\s*$/,/^void\(0\)$/i,/^about:blank$/i];for(const n of t)if(n.test(e.trim()))return!1;try{if(e.startsWith("/")||e.startsWith("./")||e.startsWith("../"))return!0;if(e.includes("://")){const n=new URL(e);return["http:","https:","ftp:","ftps:","mailto:","tel:"].includes(n.protocol)}return/^[a-zA-Z0-9][a-zA-Z0-9-_.]*[a-zA-Z0-9](\.[a-zA-Z]{2,}|:[0-9]+)/.test(e)}catch{return!1}}function ne(e){return e.replace(/\[([^\]]*)\]\(([^)]*)\)/g,(t,n,o)=>te(o)?t:n.trim()||"")}function oe(e,t){if(t&&t!=="system"&&t!=="en"){const n={zh:{source:"来源"}};if(n[t]&&n[t][e])return n[t][e]}try{if(typeof chrome<"u"&&chrome.i18n&&chrome.i18n.getMessage)return chrome.i18n.getMessage(e)||e}catch{}return e}function O(e){let t=e.replace(/\s+/g," ");return t=t.replace(/\n\s*\n/g,`

`),t=t.trim(),t}function Z(e){return Array.from(e.querySelectorAll("tr")).map(n=>Array.from(n.querySelectorAll("th, td")).map(r=>{const s=r.innerText;return re(s)}).join(",")).join(`
`)}function re(e){let t=e.replace(/[\r\n]+/g,"\\n").replace(/\s+/g," ").trim();return t.includes(",")||t.includes('"')||t.includes("\\n")?`"${t.replace(/"/g,'""')}"`:t}function D(e){const t=j();try{if(e instanceof HTMLTableElement)return G(e.outerHTML);if(e instanceof HTMLImageElement){const n=e;let o=n.dataset.src||n.src;o&&!o.startsWith("http")&&!o.startsWith("data:")&&(o=n.src);const r=n.alt||"";return!o||o===window.location.href?O(n.innerText||""):`![${r}](${o})`}else if(e instanceof HTMLPictureElement){const o=e.querySelector("img");return o?D(o):"[Picture Element - No image found]"}else if(e instanceof HTMLVideoElement){const n=e,o=n.poster,r=n.src||(n.querySelector("source")?n.querySelector("source").src:""),s=n.title||n.ariaLabel||"";return o?`![${s||"Video Poster"}](${o})`:r?`[${s||"Video Source"}](${r})`:`[Video: ${s||"No source or poster"}]`}else{if(e instanceof SVGSVGElement)return`\`\`\`svg
${e.outerHTML}
\`\`\``;if(e instanceof HTMLCanvasElement){const n=e,o=n.id?`id: '${n.id}'`:"",r=n.className?`class: '${n.className}'`:"",s=[o,r].filter(Boolean).join(", ");return`[Canvas Element${s?` (${s})`:""}]`}else if(e instanceof HTMLEmbedElement){const n=e,o=n.src,r=n.type;return o?`[Embedded Content${r?` (type: ${r})`:""}](${o})`:`[Embedded Content${r?` (type: ${r})`:""}]`}else if(e instanceof HTMLObjectElement){const n=e,o=n.data,r=n.type;return o?`[Object Content${r?` (type: ${r})`:""}](${o})`:`[Object Content${r?` (type: ${r})`:""}]`}else{if(e.tagName.toLowerCase()==="pre"||e.tagName.toLowerCase()==="code")return q(e.innerText||e.textContent||"").replace(/\n+$/,"");{const n=e.cloneNode(!0);n.querySelectorAll("#ai-copilot-copy-btn").forEach(r=>r.remove()),n.querySelectorAll("a").forEach(r=>{const s=r.querySelector("img");if(s){const c=s.alt.trim();c?r.replaceWith(document.createTextNode(c)):r.replaceWith(document.createTextNode(r.href));return}const i=r.querySelector("svg");if(i){const c=i.querySelector("title");c&&c.textContent?r.replaceWith(document.createTextNode(c.textContent.trim())):r.replaceWith(document.createTextNode(r.href))}});let o=t.turndown(n.innerHTML);return o=o.replace(/\[\s*\]\(#\)/g,""),o=ne(o),o.trim()}}}}catch(n){return console.error("Error converting to Markdown:",n,e),O(e.innerText||"")}}function J(e){try{const t=e.cloneNode(!0);if(t.querySelectorAll("#ai-copilot-copy-btn").forEach(n=>n.remove()),e instanceof HTMLImageElement){const n=e;let o=n.dataset.src||n.src;return o&&!o.startsWith("http")&&!o.startsWith("data:")&&(o=n.src),o||""}else if(e instanceof HTMLPictureElement){const o=e.querySelector("img");return o?J(o):""}else if(e instanceof HTMLVideoElement){const n=e,o=n.src||(n.querySelector("source")?n.querySelector("source").src:"");return o||n.poster||""}else{if(e instanceof SVGSVGElement)return e.outerHTML;if(e instanceof HTMLCanvasElement){const n=e,o=n.id?`id: '${n.id}'`:"",r=n.className?`class: '${n.className}'`:"",s=[o,r].filter(Boolean).join(", ");return`[Canvas Element${s?` (${s})`:""}]`}else{if(e instanceof HTMLEmbedElement)return e.src||"[Embedded Content]";if(e instanceof HTMLObjectElement)return e.data||"[Object Content]";if(e.tagName.toLowerCase()==="pre"||e.tagName.toLowerCase()==="code")return q(e.innerText||e.textContent||"");{let n=t.innerText||"";return O(n)}}}}catch(t){return console.error("Error processing plain text:",t),""}}function se(){return{title:document.title||"",url:window.location.href}}function ie(e,t){if(!e.attachTitle&&!e.attachURL)return"";const n=oe("source",e.language);let o=`

---
`;return e.outputFormat==="markdown"?e.attachTitle&&e.attachURL?o+=`${n}: [${t.title}](${t.url})`:e.attachTitle?o+=`${n}: ${t.title}`:e.attachURL&&(o+=`${n}: <${t.url}>`):e.attachTitle&&e.attachURL?o+=`${n}: ${t.title} (${t.url})`:e.attachTitle?o+=`${n}: ${t.title}`:e.attachURL&&(o+=`${n}: ${t.url}`),o}function ce(e,t){console.groupCollapsed("[Debug Content Processor] Starting processContent"),console.log("[Debug] Input element:",e),console.log("[Debug] Settings:",t);try{console.log("[Debug] Creating visible clone...");const n=Q(e);console.log("[Debug] Visible clone created:",n);let o;if(n instanceof HTMLTableElement)t.tableOutputFormat==="csv"?(console.log("[Debug] Processing as CSV table."),o=Z(n)):(console.log("[Debug] Processing as Markdown table."),o=D(n));else{const c=X(n);c.length>0?(console.log(`[Debug] Detected ${c.length} table(s) in mixed content. Processing with special handling.`),o=K(n,c,t)):(console.log("[Debug] No tables detected. Processing as standard content."),t.outputFormat==="markdown"?o=D(n):o=J(n))}t.outputFormat==="markdown"&&!(e instanceof HTMLTableElement&&t.tableOutputFormat==="csv")&&(t.attachTitle||t.attachURL)&&o&&(o=`> ${o.replace(/\n/g,`
> `)}`);const r=se(),s=ie(t,r);let i;return o&&s?i=o+s:o?i=o:s.trim()?i=s.trim():i="",console.log("[Debug] Final computed content:",i),console.groupEnd(),i}catch(n){return console.error("[Debug Content Processor] Error in processContent:",n),console.groupEnd(),e.innerText||""}}const E="copilot_settings",w={isMagicCopyEnabled:!0,isHoverMagicCopyEnabled:!0,outputFormat:"markdown",tableOutputFormat:"markdown",attachTitle:!1,attachURL:!1,language:"system",interactionMode:"click",userPrompts:[],isClipboardAccumulatorEnabled:!1};function A(){try{return typeof chrome<"u"&&chrome.i18n&&chrome.i18n.getUILanguage?chrome.i18n.getUILanguage().startsWith("zh")?"zh":"en":(console.warn("chrome.i18n.getUILanguage is not available, defaulting to English."),"en")}catch(e){return console.error("Error detecting system language:",e),"en"}}const ae=8192;async function le(){try{if(typeof chrome<"u"&&chrome.storage&&chrome.storage.sync){const t=(await chrome.storage.sync.get(E))[E],n=A();if(!t){const r={...w,language:n};return await ue(r),r}const o={...w,...t};return o.language==="system"&&(o.language=n),o}return console.warn("chrome.storage.sync is not available, returning default settings."),{...w,language:A()}}catch(e){return console.error("Error getting settings:",e),{...w,language:A()}}}async function ue(e){try{if(typeof chrome<"u"&&chrome.storage&&chrome.storage.sync){let t;try{t=(await chrome.storage.sync.get(E))[E]||w}catch{t=w}const n={...t,...e},o=JSON.stringify({[E]:n});if(new Blob([o]).size>ae){console.warn("Settings data too large for chrome.storage.sync, attempting to optimize...");const s=await de(n);await chrome.storage.sync.set({[E]:s}),console.debug("Optimized settings saved:",s)}else await chrome.storage.sync.set({[E]:n}),console.debug("Settings saved:",n)}else console.warn("chrome.storage.sync is not available, settings not saved.")}catch(t){throw console.error("Error saving settings:",t),t instanceof Error&&t.message?.includes("QUOTA_BYTES")?(console.error("Storage quota exceeded. Consider reducing the number of prompts or their size."),new Error("Storage quota exceeded. Please reduce the number or size of your prompts.")):t}}async function de(e){const t={...e};return t.userPrompts&&(t.userPrompts=t.userPrompts.map(n=>({...n,template:n.template.length>1e3?n.template.substring(0,1e3)+"...[truncated]":n.template}))),t}function y(){}y.prototype={diff:function(t,n){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=o.callback;typeof o=="function"&&(r=o,o={}),this.options=o;var s=this;function i(d){return r?(setTimeout(function(){r(void 0,d)},0),!0):d}t=this.castInput(t),n=this.castInput(n),t=this.removeEmpty(this.tokenize(t)),n=this.removeEmpty(this.tokenize(n));var c=n.length,a=t.length,l=1,p=c+a,g=[{newPos:-1,components:[]}],m=this.extractCommon(g[0],n,t,0);if(g[0].newPos+1>=c&&m+1>=a)return i([{value:this.join(n),count:n.length}]);function u(){for(var d=-1*l;d<=l;d+=2){var h=void 0,b=g[d-1],C=g[d+1],N=(C?C.newPos:0)-d;b&&(g[d-1]=void 0);var B=b&&b.newPos+1<c,k=C&&0<=N&&N<a;if(!B&&!k){g[d]=void 0;continue}if(!B||k&&b.newPos<C.newPos?(h=pe(C),s.pushComponent(h.components,void 0,!0)):(h=b,h.newPos++,s.pushComponent(h.components,!0,void 0)),N=s.extractCommon(h,n,t,d),h.newPos+1>=c&&N+1>=a)return i(fe(s,h.components,n,t,s.useLongestToken));g[d]=h}l++}if(r)(function d(){setTimeout(function(){if(l>p)return r();u()||d()},0)})();else for(;l<=p;){var v=u();if(v)return v}},pushComponent:function(t,n,o){var r=t[t.length-1];r&&r.added===n&&r.removed===o?t[t.length-1]={count:r.count+1,added:n,removed:o}:t.push({count:1,added:n,removed:o})},extractCommon:function(t,n,o,r){for(var s=n.length,i=o.length,c=t.newPos,a=c-r,l=0;c+1<s&&a+1<i&&this.equals(n[c+1],o[a+1]);)c++,a++,l++;return l&&t.components.push({count:l}),t.newPos=c,a},equals:function(t,n){return this.options.comparator?this.options.comparator(t,n):t===n||this.options.ignoreCase&&t.toLowerCase()===n.toLowerCase()},removeEmpty:function(t){for(var n=[],o=0;o<t.length;o++)t[o]&&n.push(t[o]);return n},castInput:function(t){return t},tokenize:function(t){return t.split("")},join:function(t){return t.join("")}};function fe(e,t,n,o,r){for(var s=0,i=t.length,c=0,a=0;s<i;s++){var l=t[s];if(l.removed){if(l.value=e.join(o.slice(a,a+l.count)),a+=l.count,s&&t[s-1].added){var g=t[s-1];t[s-1]=t[s],t[s]=g}}else{if(!l.added&&r){var p=n.slice(c,c+l.count);p=p.map(function(u,v){var d=o[a+v];return d.length>u.length?d:u}),l.value=e.join(p)}else l.value=e.join(n.slice(c,c+l.count));c+=l.count,l.added||(a+=l.count)}}var m=t[i-1];return i>1&&typeof m.value=="string"&&(m.added||m.removed)&&e.equals("",m.value)&&(t[i-2].value+=m.value,t.pop()),t}function pe(e){return{newPos:e.newPos,components:e.components.slice(0)}}var ge=new y;function me(e,t,n){return ge.diff(e,t,n)}var F=/^[A-Za-z\xC0-\u02C6\u02C8-\u02D7\u02DE-\u02FF\u1E00-\u1EFF]+$/,P=/\S/,Y=new y;Y.equals=function(e,t){return this.options.ignoreCase&&(e=e.toLowerCase(),t=t.toLowerCase()),e===t||this.options.ignoreWhitespace&&!P.test(e)&&!P.test(t)};Y.tokenize=function(e){for(var t=e.split(/(\s+|[()[\]{}'"]|\b)/),n=0;n<t.length-1;n++)!t[n+1]&&t[n+2]&&F.test(t[n])&&F.test(t[n+2])&&(t[n]+=t[n+2],t.splice(n+1,2),n--);return t};var _=new y;_.tokenize=function(e){var t=[],n=e.split(/(\n|\r\n)/);n[n.length-1]||n.pop();for(var o=0;o<n.length;o++){var r=n[o];o%2&&!this.options.newlineIsToken?t[t.length-1]+=r:(this.options.ignoreWhitespace&&(r=r.trim()),t.push(r))}return t};var he=new y;he.tokenize=function(e){return e.split(/(\S.+?[.!?])(?=\s+|$)/)};var ye=new y;ye.tokenize=function(e){return e.split(/([{}:;,]|\s+)/)};function M(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?M=function(t){return typeof t}:M=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},M(e)}var ve=Object.prototype.toString,L=new y;L.useLongestToken=!0;L.tokenize=_.tokenize;L.castInput=function(e){var t=this.options,n=t.undefinedReplacement,o=t.stringifyReplacer,r=o===void 0?function(s,i){return typeof i>"u"?n:i}:o;return typeof e=="string"?e:JSON.stringify(z(e,null,null,r),r,"  ")};L.equals=function(e,t){return y.prototype.equals.call(L,e.replace(/,([\r\n])/g,"$1"),t.replace(/,([\r\n])/g,"$1"))};function z(e,t,n,o,r){t=t||[],n=n||[],o&&(e=o(r,e));var s;for(s=0;s<t.length;s+=1)if(t[s]===e)return n[s];var i;if(ve.call(e)==="[object Array]"){for(t.push(e),i=new Array(e.length),n.push(i),s=0;s<e.length;s+=1)i[s]=z(e[s],t,n,o,r);return t.pop(),n.pop(),i}if(e&&e.toJSON&&(e=e.toJSON()),M(e)==="object"&&e!==null){t.push(e),i={},n.push(i);var c=[],a;for(a in e)e.hasOwnProperty(a)&&c.push(a);for(c.sort(),s=0;s<c.length;s+=1)a=c[s],i[a]=z(e[a],t,n,o,a);t.pop(),n.pop()}else i=e;return i}var I=new y;I.tokenize=function(e){return e.slice()};I.join=I.removeEmpty=function(e){return e};globalThis.chrome={i18n:{getMessage:e=>e}};const f={runAllBtn:document.getElementById("run-all-btn"),statsTotal:document.getElementById("stats-total"),statsPassed:document.getElementById("stats-passed"),statsFailed:document.getElementById("stats-failed"),testResults:document.getElementById("test-results"),batchUpdateSection:document.getElementById("batch-update-section"),batchUpdateOutput:document.getElementById("batch-update-output"),copyBatchBtn:document.getElementById("copy-batch-btn")};let x=[];const H=[],S={};function Te(){f.testResults.innerHTML="",x.forEach(e=>{const t=be({case:e,status:"running",actual:"",expected:""});f.testResults.appendChild(t)})}async function Ee(){try{const e=await fetch("test-manifest.json");if(!e.ok)throw new Error('Could not load test-manifest.json. Please run "npm run build:tests" and ensure it exists in the dist/public folder.');const t=await e.text();console.log("%c[Debug] Raw test-manifest.json content:","color: blue; font-weight: bold;",t),x=JSON.parse(t),console.log("%c[Debug] Parsed test cases object:","color: blue; font-weight: bold;",x),f.statsTotal.textContent=`Total: ${x.length}`,Te()}catch(e){const t=f.testResults;t.innerHTML=`<div class="test-case"><div class="test-header"><span class="test-title">Error</span></div><div class="test-content open"><pre>${e.message}</pre></div></div>`}}async function we(e){console.group(`[Test Case] ${e.title}`);const t=e.path.replace("cases/","snapshots/").replace(".html",".expected.md");console.log(`[Debug] Case Path from manifest: ${e.path}`),console.log(`[Debug] Derived Snapshot Path: ${t}`);let n="";try{console.error("!!! ATTEMPTING TO FETCH SNAPSHOT:",t);const u=await fetch(t);u.ok?(n=await u.text(),console.log("[Debug] Loaded snapshot content successfully.")):console.warn("[Debug] Snapshot file not found or not accessible. Status: ",u.status)}catch(u){console.error("[Debug] Error loading snapshot:",u)}const o=document.createElement("iframe");o.style.display="none",document.body.appendChild(o),console.error("!!! ATTEMPTING TO FETCH CASE HTML:",e.path);const s=await(await fetch(e.path)).text();console.log("[Debug] Fetched raw HTML for test case:",s);const i=o.contentWindow.document;i.open(),i.write(s),i.close(),await new Promise(u=>setTimeout(u,50));const c=await le(),a=i.body;console.log("[Debug] Starting content processing...");const l=ce(a,c);console.log("[Debug] Actual output from processContent:",l),document.body.removeChild(o);const p=me(n,l);let g="",m="passed";return(p.length>1||p.length===1&&(p[0].added||p[0].removed))&&(m="failed",S[t]=l,p.forEach(u=>{const v=u.added?"ins":u.removed?"del":"span";g+=`<${v}>${u.value}</${v}>`})),console.log(`[Debug] Test status: ${m}`),console.groupEnd(),{case:e,status:m,actual:l,expected:n,diff:g}}function be(e){const t=document.createElement("div");return t.className="test-case",t.id=`test-${e.case.path.replace(/[^a-zA-Z0-9]/g,"-")}`,t.innerHTML=`
    <div class="test-header">
      <span class="test-title">${e.case.title}</span>
      <span class="test-status ${e.status}">${e.status}</span>
    </div>
    <div class="test-content">
      <h3>Difference</h3>
      <div class="diff"><pre>No difference</pre></div>
      <h3>Actual Output</h3>
      <pre>${R(e.actual)}</pre>
      <h3>Expected Snapshot</h3>
      <pre>${R(e.expected)}</pre>
    </div>
  `,t.querySelector(".test-header")?.addEventListener("click",()=>{t.querySelector(".test-content")?.classList.toggle("open")}),t}function Ce(e){const t=document.getElementById(`test-${e.case.path.replace(/[^a-zA-Z0-9]/g,"-")}`);if(console.log("Updating result for:",e.case.title,"Element ID:",t?t.id:"not found"),!t){console.log("Element not found for:",e.case.title);return}const n=t.querySelector(".test-status");n.textContent=e.status,n.className=`test-status ${e.status}`,e.status==="failed"?(t.querySelector(".test-content").classList.add("open"),t.querySelector(".diff").innerHTML=`<pre>${e.diff}</pre>`,t.querySelectorAll("pre")[1].textContent=e.actual,t.querySelectorAll("pre")[2].textContent=e.expected):t.querySelector(".test-content").innerHTML="Test passed. No differences found."}function $e(){const e=H.filter(n=>n.status==="passed").length,t=H.filter(n=>n.status==="failed").length;f.statsPassed.textContent=`Passed: ${e}`,f.statsFailed.textContent=`Failed: ${t}`}function xe(){Object.keys(S).length>0?(f.batchUpdateSection.style.display="block",f.batchUpdateOutput.value=JSON.stringify(S,null,2)):f.batchUpdateSection.style.display="none"}function R(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}async function Le(){H.length=0,Object.keys(S).forEach(e=>delete S[e]);for(const e of x){const t=await we(e);H.push(t),Ce(t),$e()}xe()}f.runAllBtn.addEventListener("click",Le);f.copyBatchBtn.addEventListener("click",()=>{navigator.clipboard.writeText(f.batchUpdateOutput.value),f.copyBatchBtn.textContent="Copied!",setTimeout(()=>{f.copyBatchBtn.textContent="Copy Batch"},2e3)});Ee();
