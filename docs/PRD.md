### **产品需求文档 (PRD) - "AI Copilot" 浏览器插件 V1.1**

| **文档版本** | **V1.1** | **状态** | **评审中** |
| :--- | :--- | :--- | :--- |
| **创建日期** | 2023-10-27 | **产品负责人** | [你的名字] |
| **项目代号** | Project "MagicCopy" | **目标上线** | YYYY-MM-DD |

### **1. 产品概述 (Overview)**

#### **1.1. 项目背景**
（同V1.0，保持不变）当前，用户在与大语言模型进行交互时，频繁需要从网页复制内容作为上下文或问题素材。然而，直接从网页复制的内容往往包含大量无关的格式、样式和广告元素，用户需要手动清理和整理，费时费力。

#### **1.2. 目标用户 (Target User)**
**核心用户：** 知识工作者，包括但不限于学生、研究员、内容创作者、产品经理等。
**用户特征：**
*   高频使用AI工具进行资料研究、内容创作、学习和工作总结。
*   注重效率，对重复性、低价值的整理工作感到厌烦。

#### **1.3. 产品目标 \u0026 价值主张 (Product Goal \u0026 Value Proposition)**
**目标：** 打造一款极致简洁、高效的浏览器插件，让用户能够通过悬停操作，一键复制网页中的任意核心内容区块。
**价值主张：** **“化繁为简，悬停即复制。”** 我们通过智能算法，帮助用户自动识别网页中的核心内容区块，一键获取干净、规整的文本，极大简化信息获取流程。

#### **1.4. MVP范围 (Scope for V1.1)**
**IN-SCOPE (本次要做):**
*   核心功能：悬停在“内容区块”上时，出现复制按钮。
*   核心技术：实现一套智能区块识别算法（基于黑名单、内容密度等）。
*   核心处理：清理格式，并提供可选的附加上下文信息功能。
*   输出格式：支持Markdown（默认）和纯文本。
*   基础设置：提供一个极简的Popup面板，用于切换格式和配置附加信息。

**OUT-OF-SCOPE (本次不做):**
*   复杂的元素识别（如自动识别表格、代码块并优化）。
*   多选区合并复制。
*   自定义输出格式模板。
*   云端同步或用户账户系统。
*   复杂的、需要用户手动配置的识别规则（如DOM层级）。

---

### **2. 功能详述 (Functional Requirements)**

#### **2.1. 核心交互：智能悬停复制 (Smart Hover-Copy)**

*   **FR2.1.1: 触发方式与交互**
    *   **用户故事：** 作为一名用户，当我把鼠标移动到网页上的一大段文字或一个内容区域上时，我希望插件能自动出现一个复制按钮，让我可以立刻复制这块内容。
    *   **需求描述：**
        1.  当用户的鼠标在网页上移动时，插件在后台实时分析鼠标下方的DOM元素。
        2.  如果某个元素被算法判断为“有效内容区块”（具体算法见FR2.1.2），插件将在该元素的右上角浮现一个“复制”图标按钮。
        3.  **防抖机制：** 为避免视觉干扰，鼠标必须在目标元素上停留超过 **300ms**，复制按钮才会出现。鼠标移出元素后，按钮立即消失。
        4.  **父子元素竞合：** 如果一个子元素和其父元素都被判定为“有效内容区块”，优先响应子元素。即鼠标在子元素上时，只显示子元素的复制按钮。
    *   **设计稿/示意图：**
        ```
        +-------------------------------------------------+
        | [ICON]  \u003c-- 复制按钮出现在区块右上角              |
        |                                                 |
        |  这是一个被识别出的内容区块。Lorem ipsum dolor    |
        |  sit amet, consectetur adipiscing elit. Sed do  |
        |  eiusmod tempor incididunt ut labore et dolore  |
        |  magna aliqua.                                  |
        |                                                 |
        +-------------------------------------------------+
        ```

*   **FR2.1.2: “有效内容区块”智能识别算法**
    *   **目标：** 在不干扰用户、无需用户配置的前提下，精准识别出用户可能感兴趣的核心内容区域，过滤掉导航、广告、按钮等非内容元素。
    *   **算法规则（需同时满足多项）：**
        1.  **黑名单过滤：** 鼠标所在的元素及其任何父级元素，都**不能**是黑名单中的标签。这能有效排除整个导航栏、页头页脚等区域。（*黑名单列表详见附录A*）
        2.  **内容密度过滤：**
            *   **最小文本量：** 元素的`innerText`在去除所有空格后，字符数必须大于 **50** 个字符。这能过滤掉短标题、标签、菜单项等零碎文本。
            *   **最小尺寸：** 元素的渲染尺寸必须大于 `200px` (宽) x `40px` (高)。这能过滤掉不可见或尺寸过小的元素。
        3.  **元素类型过滤：** 元素本身**不能**是交互式或媒体元素，例如 `\u003ca\u003e`, `\u003cbutton\u003e`, `\u003cimg\u003e`, `\u003cinput\u003e`, `\u003cvideo\u003e` 等。我们关注的是包含这些元素的内容“容器”，而不是它们本身。

*   **FR2.1.3: 复制操作与反馈**
    *   **用户故事：** 作为一名用户，当我点击那个复制按钮后，我需要明确知道内容已经成功复制到我的剪贴板里了。
    *   **需求描述：**
        1.  用户点击“复制”图标按钮。
        2.  按钮的图标临时变为“已复制”或“对勾”状态，并显示1.5秒后消失。
        3.  系统将处理后的内容写入用户剪贴板。
        4.  整个过程无页面刷新，不打断用户浏览。

#### **2.2. 核心逻辑：内容处理**

*   **FR2.2.1: 内容生成规则**
    *   **用户故事：** 作为一名用户，我希望复制的内容是干净的，并且我可以自己选择要不要带上文章标题和链接。
    *   **需求描述：**
        1.  **获取内容：** 获取被识别区块的`innerText`。
        2.  **清理格式：** 去除多余的换行和空格，保留基本的段落结构。
        3.  **组合内容：** 根据用户在设置面板中的选择，组合最终文本。
            *   **默认情况：** 只包含清理后的文本。
            *   **开启附加信息：** 如果用户在设置中勾选了“附加页面标题”和/或“附加来源URL”，则在清理后的文本下方，附加上下文信息。

*   **FR2.2.2: 输出格式定义**
    *   **格式一：Markdown (默认)**
        *   **无附加信息 (默认):**
            ```markdown
            [清理后的区块文本内容]
            ```
        *   **带附加信息:**
            ```markdown
            \u003e [清理后的区块文本内容]
            
            ---
            Source: [[页面标题]]([来源URL])
            ```
    *   **格式二：纯文本**
        *   **无附加信息 (默认):**
            ```
            [清理后的区块文本内容]
            ```
        *   **带附加信息:**
            ```
            [清理后的区块文本内容]

            ---
            Source: [页面标题] ([来源URL])
            ```

#### **2.3. 插件设置 (Popup)**

*   **FR2.3.1: 设置入口与UI**
    *   **用户故事：** 作为一名用户，我希望能方便地切换复制格式，并决定是否要附带额外信息。
    *   **需求描述：**
        1.  用户点击浏览器工具栏上的插件图标，弹出一个小尺寸的设置面板（Popup）。
        2.  面板UI精简，包含以下元素：
            *   产品名称和Logo (AI Copilot V1.1)
            *   **区域一：输出格式**（单选）
            *   **区域二：附加信息**（多选）
    *   **设计稿/示意图：**
        ```
        +--------------------------+
        |   AI Copilot V1.1        |
        |--------------------------|
        | 输出格式:                |
        |   (•) Markdown           |
        |   ( ) 纯文本             |
        |--------------------------|
        | 附加信息:                |
        |   [ ] 附加页面标题       |
        |   [ ] 附加来源URL        |
        |                          |
        |   [反馈与建议]           |
        +--------------------------+
        ```

*   **FR2.3.2: 功能逻辑**
    *   **需求描述：**
        1.  所有设置项（输出格式、附加信息选项）均应被本地存储（`chrome.storage`），实现持久化。
        2.  所有选项均为即时生效，无需“保存”按钮。

---

### **3. 非功能性需求 (Non-functional Requirements)**

*   **3.1. 性能 (Performance):** 插件的JS脚本必须是轻量和高效的，特别是鼠标移动事件的监听和DOM分析逻辑，必须进行性能优化（如节流/防抖），绝不能导致页面卡顿。
*   **3.2. 兼容性 (Compatibility):** 优先支持最新版本的Google Chrome浏览器。
*   **3.3. 隐私与安全 (Privacy \u0026 Security):** 插件只在本地处理数据，不收集、不存储、不上传任何用户的网页浏览内容和复制历史。权限申请需最小化，仅申请访问页面内容和剪贴板写入权限。

---

### **附录A：HTML标签黑名单**

此列表用于 **FR2.1.2 智能识别算法** 的第一步过滤。如果鼠标悬停的元素或其任何父级元素是以下标签之一，则不触发复制按钮。

*   **结构与语义类 (排除非核心内容区):**
    *   `header`
    *   `footer`
    *   `nav`
    *   `aside`
    *   `dialog`
    *   `menu`
    *   `form`
    *   `fieldset`
    *   `legend`
*   **交互与表单类 (排除功能性控件):**
    *   `a`
    *   `button`
    *   `input`
    *   `textarea`
    *   `select`
    *   `option`
    *   `optgroup`
    *   `label`
    *   `details`
    *   `summary`
*   **媒体与嵌入类 (排除非文本内容):**
    *   `img`
    *   `iframe`
    *   `video`
    *   `audio`
    *   `canvas`
    *   `embed`
    *   `object`
    *   `picture`
    *   `map`
    *   `area`
*   **元数据与脚本类 (排除不可见元素):**
    *   `script`
    *   `style`
    *   `noscript`
    *   `head`
    *   `meta`
    *   `link`
    *   `template`
